<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight {
  color: #faf6e4;
  background-color: #122b3b;
}
.highlight .gl {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #6c8b9f;
  font-style: italic;
}
.highlight .cp {
  color: #b2fd6d;
  font-weight: bold;
  font-style: italic;
}
.highlight .err {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .gr {
  color: #fefeec;
  background-color: #cc0000;
}
.highlight .k, .highlight .kd, .highlight .kv {
  color: #f6dd62;
  font-weight: bold;
}
.highlight .o, .highlight .ow {
  color: #4df4ff;
}
.highlight .p, .highlight .pi {
  color: #4df4ff;
}
.highlight .gd {
  color: #cc0000;
}
.highlight .gi {
  color: #b2fd6d;
}
.highlight .ge {
  font-style: italic;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gt {
  color: #dee5e7;
  background-color: #4e5d62;
}
.highlight .kc {
  color: #f696db;
  font-weight: bold;
}
.highlight .kn {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kp {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kr {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gh {
  color: #ffb000;
  font-weight: bold;
}
.highlight .gu {
  color: #ffb000;
  font-weight: bold;
}
.highlight .kt {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .no {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nc {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nd {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nn {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .bp {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .ne {
  color: #b2fd6d;
  font-weight: bold;
}
.highlight .nl {
  color: #ffb000;
  font-weight: bold;
}
.highlight .nt {
  color: #ffb000;
  font-weight: bold;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #f696db;
  font-weight: bold;
}
.highlight .ld {
  color: #f696db;
  font-weight: bold;
}
.highlight .ss {
  color: #f696db;
  font-weight: bold;
}
.highlight .s, .highlight .sb, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .sr, .highlight .s1 {
  color: #fff0a6;
  font-weight: bold;
}
.highlight .se {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .sc {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .si {
  color: #4df4ff;
  font-weight: bold;
}
.highlight .nb {
  font-weight: bold;
}
.highlight .ni {
  color: #999999;
  font-weight: bold;
}
.highlight .w {
  color: #BBBBBB;
}
.highlight .nf {
  color: #a8e1fe;
}
.highlight .py {
  color: #a8e1fe;
}
.highlight .na {
  color: #a8e1fe;
}
.highlight .nv, .highlight .vc, .highlight .vg, .highlight .vi {
  color: #a8e1fe;
  font-weight: bold;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-72314368-1', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Built with love using Web Starter Kit -->
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/kengz/aiva'>AIVA Github</a></li>
            <li><a href='https://github.com/kengz/aiva-doc'>AIVA documentation Github</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="aiva">AIVA <a href="http://badge.fury.io/gh/kengz%2Faiva"><img alt="GitHub version" src="https://badge.fury.io/gh/kengz%2Faiva.svg" /></a> <a href="https://travis-ci.org/kengz/aiva"><img alt="Build Status" src="https://travis-ci.org/kengz/aiva.svg?branch=master" /></a> <a href="https://coveralls.io/github/kengz/aiva?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/kengz/aiva/badge.svg?branch=master" /></a> <a href="https://gemnasium.com/kengz/aiva"><img alt="Dependency Status" src="https://gemnasium.com/kengz/aiva.svg" /></a> <a href="https://raw.githubusercontent.com/hyperium/hyper/master/LICENSE"><img alt="MIT licensed" src="https://img.shields.io/badge/license-MIT-blue.svg" /></a> <iframe src="https://ghbtns.com/github-btn.html?user=kengz&repo=aiva&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe></h1>

<p><strong>AIVA</strong> (A.I. Virtual Assistant): General-purpose virtual assistant for developers.</p>

<p>It is a <strong>bot-generalization</strong>: you can implement any features, use with major AI tools, deploy across platforms, and code in multiple languages.</p>

<table><thead>
<tr>
<th style="text-align: left">AIVA is</th>
<th>Details</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">general-purpose</td>
<td>An app interface, AI assistant, anything!</td>
</tr>
<tr>
<td style="text-align: left">cross-platform</td>
<td>Deploy simultaneously on <strong>Slack, Telegram, Facebook</strong>, or any <a href="https://github.com/github/hubot/blob/master/docs/adapters.md">hubot adapters</a></td>
</tr>
<tr>
<td style="text-align: left">multi-language</td>
<td>Code in and coordinate among <code class="prettyprint">Node.js</code>, <code class="prettyprint">Python</code>, <code class="prettyprint">Ruby</code>, etc.</td>
</tr>
<tr>
<td style="text-align: left">built-in with AI tools</td>
<td>Tensorflow, SkFlow, Scikit, Pandas, Indico.ml, spaCy, Watson, Google APIs</td>
</tr>
<tr>
<td style="text-align: left">hackable</td>
<td>It extends <a href="https://github.com/github/hubot">Hubot</a>. Add your own modules!</td>
</tr>
<tr>
<td style="text-align: left">powerful, easy to use</td>
<td>Check out <a href="#setup">setup</a> and <a href="#features">features</a></td>
</tr>
</tbody></table>

<blockquote>
<p>To see what they mean, say you have a todo-list feature for AIVA, written in Node.js and leverages NLP and ML from Python. Set your todo list earlier from Slack on desktop? You can access it from Telegram or Facebook on mobile.</p>
</blockquote>

<p>We see people spending a lot of time building bots instead of focusing on what they want to do. It still requires much effort to just get a bot up and running. Moreover, the bot built is often confined to a single language, single platform, and without AI capabilities.</p>

<p>Why restrict when you can have all of it? Why build multiple bots when you can have one that plugs into all platforms and runs all languages?</p>

<p>AIVA exists to help with that - we do the heavy-lifting and build a ready-to-use bot; it is general purpose, multi-language, cross-platform, with robust design and tests, to suite your needs. </p>

<p>AIVA gives you powerful bot tools, saves you the time to build from scratch, and allows you to focus on what you want to do. Morever, you can <strong>build once, run everywhere</strong> with AIVA&rsquo;s multi-adapter <a href="#adapters">(Slack, Telegram, Fb)</a>.</p>

<h2 id="installation">Installation</h2>

<p>1. Fork this repo so you can pull the new releases later:</p>

<p>&nbsp; &nbsp; <iframe src="https://ghbtns.com/github-btn.html?user=kengz&repo=aiva&type=fork&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe></p>

<p>2. Clone <strong>your forked repository</strong>:</p>
<pre class="highlight shell"><code>git clone https://github.com/YOURUSERNAME/aiva.git
</code></pre>

<h2 id="setup-run"><a name="setup"></a>Setup, Run</h2>

<p>You can run AIVA on your local machine or a Ubuntu server - <a href="https://www.digitalocean.com">Digital Ocean</a> recommended. See <a href="#docker-installation">Docker installation</a> if you&rsquo;re new to it, or the <a href="#dependencies">alternate setups</a>.</p>

<ul>
<li><strong>dependencies</strong>: Pull the <a href="https://hub.docker.com/r/kengz/aiva/">AIVA Docker image</a>:</li>
</ul>
<pre class="highlight shell"><code>docker pull kengz/aiva
</code></pre>

<ul>
<li><strong>setup keys</strong>: update <code class="prettyprint">.env</code>, <code class="prettyprint">bin/.key-aiva</code> (production), <code class="prettyprint">bin/.key-aivadev</code> (development).</li>
</ul>

<aside class="notice">
On Mac OSX, before using Docker, make sure there&rsquo;s a <code>default</code> docker machine running: <code>docker-machine start default</code>.
</aside>

<h3 id="run"><a name="run"></a>Run</h3>

<ul>
<li><strong>run</strong>: </li>
</ul>
<pre class="highlight shell"><code>npm start <span class="c"># runs aivadev</span>
</code></pre>

<p>See <a href="#commands">Commands</a> for more. This will start AIVA with the default hubot adapters: Slack, Telegram, Facebook. See <a href="#adapters"><strong>Adapters</strong></a> for connecting to different chat platforms.</p>

<blockquote>
<p>AIVA saying hi, translating, running deep neural net; on Slack, Telegram, Facebook:
<img alt="AIVA on Slack, Telegram" src="./images/npm_start.png" /></p>
</blockquote>

<p>Check <a href="#setup-tips"><strong>Setup tips</strong></a> for help.</p>

          <h1 id="features"><a name="features"></a>Features</h1>

<p>This gives a top level overview of the features. See <a href="#modules">Modules</a> to find usable functions for developers.</p>

<table><thead>
<tr>
<th style="text-align: left">Feature</th>
<th>Implemented?</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="#setup2">fast setup</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#docker">docker</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#cross-platform">cross-platform</a></td>
<td>implementing</td>
</tr>
<tr>
<td style="text-align: left"><a href="#custom-msg">customMessage</a></td>
<td>pending</td>
</tr>
<tr>
<td style="text-align: left"><a href="#graph-brain">graph brain</a></td>
<td>improving</td>
</tr>
<tr>
<td style="text-align: left"><a href="#multi-language">multi-language</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#builtin-ai">built-in AI tools</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#theoretical">theoretical power</a></td>
<td>yes</td>
</tr>
</tbody></table>

<h2 id="fast-setup"><a name="setup2"></a>fast setup</h2>

<p><a href="#setup">3 steps</a> to get a bot installed and running. It once took me just 15 seconds to deploy a bot for an unexpected demo. </p>

<p><em>P/S &ldquo;fast&rdquo; implies the least number of steps; dependency installation can be heavy and long.</em></p>

<h2 id="docker"><a name="docker"></a>Docker</h2>

<p>Complex projects tend to be difficult to install and distribute. Docker has become a preferred solution, especially for heavy machine learning projects. Docker also provides a fast and safe development environment through containerization.</p>
<pre class="highlight shell"><code>docker pull kengz/aiva
</code></pre>

<p>AIVA is quite heavy on dependencies, understandably. So we&rsquo;ve add an <a href="https://hub.docker.com/r/kengz/aiva/">AIVA docker image <code class="prettyprint">kengz/aiva</code></a> since <code class="prettyprint">v3.2.0</code>, and development is seamless with it. See <a href="#docker-installation">Docker installation</a>.</p>

<h2 id="cross-platform"><a name="cross-platform"></a>cross-platform</h2>

<p>The Facebook bot paradigm is &ldquo;why use multiple apps when you can access them from one bot?&rdquo;. We dare to ask &ldquo;why talk to the bot from one platform instead of everywhere?&rdquo; With AIVA we can <strong>build once, run everywhere</strong>.</p>

<h3 id="omnipresence">Omnipresence</h3>

<p>This inspires the <strong>omnipresence</strong> feature: a bot that recognizes who you are, and can continue conversation in any supported platforms. We talk to our friends everywhere, and they don&rsquo;t forget us when we switch apps. Bots should do the same too.</p>

<p>In short: <strong>one brain, multiple interfaces</strong>. AIVA&rsquo;s hubot base allows for generality, and it can tap into multiple platforms by using different <a href="#adapters">adapters</a>. Unlike the original hubot though, she can exist simultaneously on multiple platforms by having several interface instances plugged into the respective adapters, and all share the same brain, which serves as the central memory.</p>

<p>See <a href="#adapters">adapters</a> for more.</p>

<h2 id="custommessage"><a name="custom-msg"></a>customMessage</h2>

<p>Sending plain texts to different adapters is straightforward. However, sometimes we wish to take advantage of the available custom formatting of a platform, such as Slack attachment or Facebook rich messages.</p>

<p>These special messages can be sent via <code class="prettyprint">robot.adapter.customMessage(attachments)</code> - a method that most adapters implement (Slack, Telegram, Facebook adapters have it). All we need to do is to format the attachments properly by detecting the current adapter using <code class="prettyprint">robot.adapterName</code>, then format the attachments to the right format with <code class="prettyprint">customFormat</code>.</p>

<p>See <a href="#adapters">adapters</a> for more.</p>

<aside class="notice">
Implementation is complete for Slack, Telegram, but partial for Facebook adapter since it&rsquo;s quite new. We are working with the adapter&rsquo;s author to complete this very soon - will be done in the next release soon.
</aside>

<h2 id="graph-brain"><a name="graph-brain"></a>graph brain</h2>

<p>The brain of AIVA is a graph database; it is the central memory that coordinates with different adapters, allowing it to be consistent across the platforms; for example, it can remember who you are or your todo list, even as you switch apps.</p>

<p>Graph is a very generic and natural way of encoding information, especially for information that doesn&rsquo;t always follow a fixed schema. A knowledge base is often implemented as a graph (wordNet, conceptNet, google graph, facebook graph, etc.) due to the adhoc and connected nature of generic knowledge. Thus, we think it&rsquo;s the natural choice for AIVA.</p>

<p>Although graph and non-graph databases can both be Turing-complete, graphs tend to have a lower working complexity in practice, and it&rsquo;s data units can be schema-free. Turing completeness ensures that the database can do everything a computer supposedly can; lower complexity makes development easier, schema-free allows knowledge creation on-the-fly.</p>

<p>AIVA uses <a href="https://github.com/kengz/neo4jKB"><code class="prettyprint">neo4jKB</code></a> as the brain - a knowledge base implemented graph with <a href="http://neo4j.com"><code class="prettyprint">neo4j</code></a>. Specifically, <code class="prettyprint">neo4jKB</code> imposes a <a href="https://github.com/kengz/neo4jKB#kb-standard-basic">KB standard</a> on the graph for proper usage as a knowledge base.</p>

<aside class="notice">
Neo4jKB is a completed project. Currently it is used for user-recognition and user todo list. AIVA doesn&rsquo;t fully utilize Neo4jKB yet as the AI tools are under development. When done, AIVA will be able to automatically form and extract knowledge from the graph brain.
</aside>

<aside class="notice">
User serialization that depends on the brain is complete for Slack, but partial for Telegram, Facebook. They will be done in the next release soon.
</aside>

<h2 id="multi-language"><a name="multi-language"></a>multi-language</h2>

<p><strong>Unite we stand</strong>. When different languages work together, we can access a much larger set of development tools. Also, we wish that a developer can use the AIVA regardless of his/her favorite programming language. </p>

<p>For more, see <a href="#polyglot">Polyglot environment</a> and <a href="#clients">Socket.io clients</a> for how it&rsquo;s done. We now support <code class="prettyprint">node.js, python, ruby</code>.</p>

<h2 id="built-in-ai-tools"><a name="builtin-ai"></a>built-in AI tools</h2>

<p>AIVA comes with a set of well-rounded set AI/machine learning tools - each is the most advanced of its type. We have packaged these tools nicely, so you can get right into work with them. This saves you the tideous hunt, installation, and setup. </p>

<p><code class="prettyprint">lib/&lt;lang&gt;/ais/</code> contains the specific implementations of the AI modules/models, and <code class="prettyprint">lib/&lt;lang&gt;/ai.&lt;lang&gt;</code> is the high-level script that imports the functions from <code class="prettyprint">lib/&lt;lang&gt;/ais/</code> for usage.</p>

<p>Thanks to the multi-language feature, we can easily access the machine learning universe of Python. For example, <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/" target="_blank"><code>lib/py/ais/</code></a> contains a sample Tensorflow training script <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/dnn_titanic_train.py" target="_blank"><code>dnn_titanic_train.py</code></a>, and a script to deploy that DNN for usage <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/dnn_titanic_deploy.py" target="_blank"><code>dnn_titanic_deploy.py</code></a>. It is interfaced through <a href="https://github.com/kengz/aiva/tree/master/scripts/dnn_titanic.js" target="_blank"><code>scripts/dnn_titanic.js</code></a> that allows you to use run predictions.</p>

<p>The list of AI modules and their respective language:</p>

<table><thead>
<tr>
<th style="text-align: left">AI/ML</th>
<th>type</th>
<th>lang</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="https://www.tensorflow.org">Tensorflow</a></td>
<td>Neural Nets</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="http://scikit-learn.org/stable/">scikit-learn</a></td>
<td>Generic ML algorithms</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/tensorflow/skflow">SkFlow</a></td>
<td>Tensorflow + Scikit-learn</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://spacy.io">spaCy</a></td>
<td>NLP</td>
<td>Python</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/wit-ai/node-wit">Wit.ai</a></td>
<td>NLP for developers</td>
<td>Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://indico.io">Indico.io</a></td>
<td>text+image analysis</td>
<td>(REST API) Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="http://www.ibm.com/cloud-computing/bluemix/watson/">IBM Watson</a></td>
<td>cognitive computing</td>
<td>Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://console.developers.google.com/apis">Google API</a></td>
<td>multiple</td>
<td>Node.js client</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/Planeshifter/node-concept-net">ConceptNet</a></td>
<td>semantic network</td>
<td>(REST API) Node.js interface</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/NaturalNode/natural">NodeNatural</a></td>
<td>NLP</td>
<td>Node.js</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/moos/wordpos">wordpos</a></td>
<td>WordNet POS</td>
<td>Node.js</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/matthewmueller/date">date.js</a></td>
<td>time-parsing</td>
<td>Node.js</td>
</tr>
</tbody></table>

<p>These tools are put close together in a <a href="#polyglot">polyglot environment</a>, so you can start combining them in brand new ways. An example is the generic NLP parser <a href="https://github.com/kengz/aiva/blob/master/lib/js/gen_nlp.js" target="_blank"><code>lib/js/gen_nlp.js</code></a> for parsing user input into intent and functional arguments - it uses <code class="prettyprint">date.js</code> and <code class="prettyprint">spaCy</code>.</p>

<p>For more in-depth details, see <a href="#modules">modules</a>. Also if find a great ML tool we should include, submit a Pull Request!</p>

<h2 id="theoretical-power"><a name="theoretical"></a>theoretical power</h2>

<p>AIVA is based on a theoretical interface <a href="https://github.com/kengz/aiva/tree/master/docs/HTMI.md">HTMI</a> and a brain <a href="https://github.com/kengz/aiva/tree/master/docs/CGKB.md">CGKB</a> that is <em>human-bounded Turing complete</em>. The theorem establishes that HTMI can be used by a human to solve any problems or perform any functions she enumerates that are solvable by a Turing Machine. Complete implementation is still underway.</p>

<p>Why is this important? Because for far too many times people have tried to solve problems that are unsolvable. Many of the bots out there are actually very restrictive. To allow developers to solve problems with full power, and with easy, we have built a general-purpose tool and made it theoretically complete, so you can focus on solving your problem.</p>

          <h1 id="ai-modules"><a name="modules"></a>AI Modules</h1>

<p>AIVA comes with a set of well-rounded set AI/machine learning tools - each is the most advanced of its type. You can use the as needed, directly from within AIVA without extra installations. This section gives a quick overview of their uses, and some useful helper modules.</p>

<table><thead>
<tr>
<th style="text-align: left">Module</th>
<th>Implemented?</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="#gen_nlp">general NLP</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#witai">Wit.ai</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#tensorflow">TensorFlow</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#skflow">SkFlow</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#indico">Indico.io</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#kbase">Knowledge base</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#neo4jKB-brain">neo4jKB brain</a></td>
<td>minimal</td>
</tr>
<tr>
<td style="text-align: left"><a href="#google-api">Google APIs</a></td>
<td>yes</td>
</tr>
<tr>
<td style="text-align: left"><a href="#watson">IBM Watson</a></td>
<td>yes</td>
</tr>
</tbody></table>

<aside class="notice">
To see all the available AI modules and methods, print the <code>ai</code> objects from <code>lib/js/ai.js</code> and <code>lib/py/ai.py</code>.
</aside>

<h2 id="general-nlp"><a name="gen_nlp"></a>general NLP</h2>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_ai.js</span>
<span class="kd">var</span> <span class="nx">genNLP</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../lib/js/gen_nlp'</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../lib/client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="s1">'find me flights from New York to London at 9pm tomorrow.'</span>

<span class="nx">genNLP</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">reply</span><span class="p">))</span>
<span class="p">})</span>
</code></pre>

<p>NLP is core to a human-machine interactions. We provide one of the fastest and most advanced NLP module in <code class="prettyprint">lib/js/gen_nlp</code> for generic usage. It serves as a convenient method to get all the vital NLP results. This is especially useful in the <code class="prettyprint">js</code> <strong>interface</strong> scripts for <em>parsing user inputs, normalizing texts, and extracting information</em>.</p>

<p>A large part of it is powered by <a href="https://spacy.io">spaCy</a>, which is <em>&ldquo;the fastest syntactic parser in the world and that its accuracy is within 1% of the best available&rdquo;</em>. The time parser uses <a href="https://github.com/matthewmueller/date">date</a>. Together, <code class="prettyprint">gen_nlp</code> extracts a rich and accurate set of results for connecting natural language input to your modules.</p>

<p>Next we show an example of how a flight finder can benefit from it. For instance, it can get the <code class="prettyprint">NER</code> or <code class="prettyprint">noun_phrases</code> for the locations, time, person; the <code class="prettyprint">time</code> for a normalized form of ISO time string; <code class="prettyprint">NER_POS_TREE</code> to understand the dependencies, e.g. what&rsquo;s the origin and target destinations.</p>

<blockquote>
<p>The example in <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_ai.js#L5" target="_blank"><code>scripts/hello_ai.js</code></a> shows how the generic NLP module in <a href="https://github.com/kengz/aiva/tree/master/lib/js/gen_nlp.js" target="_blank"><code>lib/js/gen_nlp.js</code></a> returns the result pulled from spaCy in Python, and Date.js in Node.js.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// the result from genNLP.parse(input)</span>

<span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"len"</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="s2">"pos_fine"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"PRP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NNS"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"York"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"NNP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"IN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9"</span><span class="p">,</span> <span class="s2">"CD"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"NN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"."</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9pm"</span><span class="p">,</span> <span class="s2">"TIME"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"lemmas"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"me"</span><span class="p">,</span> <span class="s2">"flight"</span><span class="p">,</span> <span class="s2">"from"</span><span class="p">,</span> <span class="s2">"new"</span><span class="p">,</span> <span class="s2">"york"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"london"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">,</span> <span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"."</span><span class="p">],</span>
  <span class="s2">"tokens"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"me"</span><span class="p">,</span> <span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"from"</span><span class="p">,</span> <span class="s2">"New"</span><span class="p">,</span> <span class="s2">"York"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"London"</span><span class="p">,</span> <span class="s2">"at"</span><span class="p">,</span> <span class="s2">"9"</span><span class="p">,</span> <span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"."</span><span class="p">],</span>
  <span class="s2">"pos_coarse"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VERB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"York"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9"</span><span class="p">,</span> <span class="s2">"NUM"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"pm"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"PUNCT"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER_POS_tag"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">"find"</span><span class="p">,</span> <span class="s2">"VERB"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"flights"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"London"</span><span class="p">,</span> <span class="s2">"GPE"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"at"</span><span class="p">,</span> <span class="s2">"ADP"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"9pm"</span><span class="p">,</span> <span class="s2">"TIME"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"tomorrow"</span><span class="p">,</span> <span class="s2">"NOUN"</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">"."</span><span class="p">,</span> <span class="s2">"PUNCT"</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="s2">"NER_POS_tree"</span><span class="p">:</span> <span class="p">[{</span>
    <span class="s2">"find"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s2">"flights"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">"me"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"nsubj"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"from"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"New York"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"GPE"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"to"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"London"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"GPE"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"at"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">"9pm"</span><span class="p">:</span> <span class="p">{</span>
                  <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
                  <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"pobj"</span><span class="p">,</span>
                  <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"TIME"</span>
                <span class="p">}</span>
              <span class="p">}],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"prep"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"ADP"</span>
            <span class="p">}</span>
          <span class="p">},</span> <span class="p">{</span>
            <span class="s2">"tomorrow"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
              <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"npadvmod"</span><span class="p">,</span>
              <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
            <span class="p">}</span>
          <span class="p">}],</span>
          <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"ccomp"</span><span class="p">,</span>
          <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"NOUN"</span>
        <span class="p">}</span>
      <span class="p">},</span> <span class="p">{</span>
        <span class="s2">"."</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"children"</span><span class="p">:</span> <span class="p">[],</span>
          <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"punct"</span><span class="p">,</span>
          <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"PUNCT"</span>
        <span class="p">}</span>
      <span class="p">}],</span>
      <span class="s2">"edge"</span><span class="p">:</span> <span class="s2">"ROOT"</span><span class="p">,</span>
      <span class="s2">"tag"</span><span class="p">:</span> <span class="s2">"VERB"</span>
    <span class="p">}</span>
  <span class="p">}],</span>
  <span class="s2">"noun_phrases"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"me"</span><span class="p">,</span> <span class="s2">"New York"</span><span class="p">,</span> <span class="s2">"London"</span><span class="p">,</span> <span class="s2">"9pm"</span><span class="p">],</span>
  <span class="s2">"text"</span><span class="p">:</span> <span class="s2">"find me flights from New York to London at 9 pm tomorrow ."</span><span class="p">,</span>
  <span class="s2">"time"</span><span class="p">:</span> <span class="s2">"2016-04-24T01:00:00.042Z"</span>
<span class="p">}</span>
</code></pre>

<p>The extracted NLP properties are listed below. For more details, refer to the links.</p>

<table><thead>
<tr>
<th style="text-align: left">NLP property</th>
<th>Reference</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">text</td>
<td>The original input text.</td>
</tr>
<tr>
<td style="text-align: left">len</td>
<td>Length: <a href="https://spacy.io/docs#doc-sequenceapi">number of tokens in text</a>.</td>
</tr>
<tr>
<td style="text-align: left">tokens</td>
<td>Text broken into <a href="https://spacy.io/docs#annotation-tokenization">array of tokens</a>.</td>
</tr>
<tr>
<td style="text-align: left">lemmas</td>
<td>The <a href="https://spacy.io/docs#annotation-lemmatization">base form</a> of each token.</td>
</tr>
<tr>
<td style="text-align: left">NER</td>
<td><a href="https://spacy.io/docs#annotation-ner">Named Entity Recognition</a></td>
</tr>
<tr>
<td style="text-align: left">noun_phrases</td>
<td><a href="https://spacy.io/docs#doc-spans-nounchunks">grouping of meaningful nouns</a></td>
</tr>
<tr>
<td style="text-align: left">pos_coarse</td>
<td><a href="https://spacy.io/docs#token-postags">Coarse</a> Part-of-speech tagging.</td>
</tr>
<tr>
<td style="text-align: left">pos_fine</td>
<td><a href="https://spacy.io/docs#token-postags">Finer</a> Part-of-speech tagging.</td>
</tr>
<tr>
<td style="text-align: left">NER_POS_tree</td>
<td>The <a href="https://spacy.io/docs#doc-spans-nounchunks">syntactic and dependency parse tree</a> of text, seen in <a href="https://spacy.io/demos/displacy">DisplaCy</a></td>
</tr>
<tr>
<td style="text-align: left">NER_POS_tag</td>
<td>The flatten array of NER_POS_tree, without the dependencies.</td>
</tr>
<tr>
<td style="text-align: left">time</td>
<td><a href="https://github.com/matthewmueller/date">Parsed time</a> if any, as ISO time string.</td>
</tr>
</tbody></table>

<h2 id="wit-ai"><a name="witai"></a>Wit.ai</h2>

<p><a href="https://wit.ai/">Wit.ai</a> is pretty sick, with a bot engine powered by AI. They are now part of Facebook, if you don&rsquo;t already know, and it&rsquo;s free to use.</p>

<p>AIVA is fully compatible with Wit.ai, and we use its <a href="https://github.com/wit-ai/node-wit">Node.js client</a>. Bear in mind that you need to manually train it for each human input you wish to parse, or you can find some existing trained models. Their own guide is pretty comprehensive, so we won&rsquo;t discuss much here.</p>
<pre class="highlight shell"><code><span class="c"># install to use wit.ai</span>
npm i --save node-wit
</code></pre>

<blockquote>
<p>Then add the token to bin/.keys-aiva and bin/.keys-aivadev; it will be set automatically.</p>
</blockquote>
<pre class="highlight shell"><code><span class="nv">WIT_TOKEN</span><span class="o">=</span>&lt;your_wit_token&gt;
</code></pre>

<h2 id="tensorflow"><a name="tensorflow"></a>TensorFlow</h2>

<p><a href="https://www.tensorflow.org">TensorFlow</a> is used mainly to build neural networks. There is a lot of comprehensive tutorials for it, so instead we will introduce you to the fastest TensorFlow interface: <a href="https://github.com/tensorflow/skflow">SkFlow</a>.</p>

<p>SkFlow makes it very easy to use TensorFlow, and insanely fast to build a model. It comes with many useful wrapped methods and models. Check out this <a href="http://terrytangyuan.github.io/2016/03/14/scikit-flow-intro/">demo post written by the team</a>, their <a href="https://github.com/tensorflow/skflow#tutorial">tutorials</a>, and <a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/skflow">examples</a>.</p>

<p>We show how you can deploy a neural net with AIVA, with a sample Deep Neural Network trained on the Titanic data.</p>

<p>The TensorFlow (and other) AI models shall be grouped under <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/" target="_blank"><code>lib/py/ais/</code></a>. The top level <a href="https://github.com/kengz/aiva/tree/master/lib/py/ai.py" target="_blank"><code>lib/py/ai.py</code></a> script will import from this folder for usage via Socket.io.</p>

<blockquote>
<p>The Titanic DNN model can be trained using TensorFlow under <a href="https://github.com/kengz/aiva/blob/master/lib/py/ais/dnn_titanic_train.py#L53" target="_blank"><code>lib/py/ais/dnn_titanic_train.py</code></a> after you uncomment and run it. It draws data from the sibling folder <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/data/" target="_blank"><code>lib/py/ais/data/</code></a>, and the model is saved to <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/models/" target="_blank">lib/py/ais/models/</a>. </p>

<p>For deployment, <a href="https://github.com/kengz/aiva/tree/master/lib/py/ai.py" target="_blank"><code>lib/py/ai.py</code></a> imports and exposes the methods in <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/dnn_titanic_deploy.py" target="_blank">lib/py/ais/dnn_titanic_deploy.py</a>. They can then be used to do predictions from the interface <a href="https://github.com/kengz/aiva/tree/master/scripts/dnn_titanic.js" target="_blank">scripts/dnn_titanic.js</a>.</p>

<p>TensorFlow Titanic DNN on Slack:
<img alt="Titanic DNN on Slack" src="./images/titanic_dnn.png" /></p>
</blockquote>

<p>This demonstrates another AI component of AIVA; not only AI can power the bot, the bot can serve as an interface to specific AIs too. Feel free to explore the examples in AIVA and the resources given earlier. Doing AI is much easier today!</p>

<table><thead>
<tr>
<th style="text-align: left">file/folder</th>
<th>details</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/dnn_titanic_train.py" target="_blank">lib/py/ais/dnn_titanic_train.py</a></td>
<td>Train and save the Titanic DNN model.</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/data/" target="_blank">lib/py/ais/data/</a></td>
<td>Folder for training and test data.</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/models/" target="_blank">lib/py/ais/models/</a></td>
<td>Folder for the saved model for deployment. Will be created when new model is trained.</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/ai_lib/" target="_blank">lib/py/ais/ai_lib/</a></td>
<td>Library with helpers for the AI folder.</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/dnn_titanic_deploy.py" target="_blank">lib/py/ais/dnn_titanic_deploy.py</a></td>
<td>Deploy the DNN titatnic model.</td>
</tr>
<tr>
<td style="text-align: left"><a href="https://github.com/kengz/aiva/tree/master/scripts/dnn_titanic.js" target="_blank">scripts/dnn_titanic.js</a></td>
<td>Interface script for the deployed model.</td>
</tr>
</tbody></table>

<p>Yes, <em>you did just train a Deep Neural Network and deploy it on Slack for use</em>. The mythical creative of deep learning - now at your fingertips - is going to help you unleash a whole new world of possibilities. And thatâ€™s not all; remember, there is an entire package of every major type of machine learning tools, all included in AIVA. Next, we will go over them quickly, and leave you to explore them more deeply.</p>

<p>See <a href="https://github.com/tensorflow/skflow">SkFlow</a> for their tutorials and documentation.</p>

<h2 id="skflow-modules"><a name="skflow"></a>SkFlow Modules</h2>

<p>SkFlow is under TensorFlow. Besides, SkFlow also comes with:</p>

<ul>
<li><a href="http://scikit-learn.org"><strong>scikit-learn</strong></a></li>
<li><a href="http://pandas.pydata.org"><strong>pandas</strong></a> </li>
</ul>

<p>both of which are very popular Python machine learning libraries for techniques that complement the neural nets. SkFlow is designed to be used with all three of them: TensorFlow, scikit and pandas.</p>

<h2 id="indico-io"><a name="indico"></a>Indico.io</h2>

<p><a href="https://indico.io">Indico.io</a> is <strong>the go-to machine learning API</strong> for developers. It focuses on the most applicable and useful ML tools for <a href="https://indico.io/product">text and image analysis</a>. This complements the custom-trained models of TensorFlow, and is useful especially when your use case can readily be solved by standard ML models.</p>

<blockquote>
<p>The indico wrapper is grouped under the <code class="prettyprint">ai</code> module. Remember to save your API key into the <code class="prettyprint">.keys-</code> before using. A simple example can be found at <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_ai.js#L18" target="_blank"><code>scripts/hello_ai.js</code></a>.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_ai.js</span>
<span class="kd">var</span> <span class="nx">ai</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../lib/js/ai'</span><span class="p">)</span>
<span class="nx">ai</span><span class="p">.</span><span class="nx">indico</span><span class="p">.</span><span class="nx">sentiment</span><span class="p">([</span><span class="s1">'indico is so easy to use!'</span><span class="p">,</span> <span class="s1">'Still really easy, yiss'</span><span class="p">])</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// [ 0.9782025594088044, 0.9895808115135271 ]</span>
</code></pre>

<blockquote>
<p>We also add an interface script <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_ai.js" target="_blank"><code>below that</code></a>, and demo it on Telegram. Of course the real application is likely backend oriented, such as gauging the quality of your customer service by analyzing their sentiment in chat.</p>

<p>Indico on Telegram:
<img alt="Indico on Telegram" src="./images/indico.png" /></p>
</blockquote>

<p>With Indico.io, everything is done via its REST API or their <a href="https://indico.io/docs">wrapper clients</a> - no model/training is needed. AIVA includes the <a href="https://github.com/IndicoDataSolutions/IndicoIo-node">Node.js Indico.io wrapper</a>, nested under the <a href="https://github.com/kengz/aiva/tree/master/lib/js/ai.js" target="_blank">lib/js/ai.js</a>.</p>

<p>In fact, Indico is currently <a href="https://indico.io/news/121515_indico_SentimentHQ_Release">state of the art</a> in sentiment analysis. All their APIs are very powerful and easy to use; they even explain the ML models employed for each, and the real-world use cases of each.</p>

<p><a href="https://indico.io/docs">Read their docs</a>, <a href="https://indico.io/product">see what they offer</a>, and get <a href="https://indico.io/plans">your API key here</a>. You can get 10k free calls per month, which is sufficient for personal/small team usage.</p>

<h2 id="knowledge-base"><a name="kbase"></a>Knowledge base</h2>

<p>Sometimes we need a bot to have general knowledge, such as what a phone is, as well as local knowledge, such as user preferences. This can aid with its functions, and allow for <strong>autoplanning</strong>.</p>

<p>Autoplanning is vital for a bot to be able to function on its own without being explicitly told about every small detail of a task. Take the example input &ldquo;call my wife&rdquo;. It&rsquo;s true that we can hard-code the logic to find who &ldquo;wife&rdquo; is for a given person, get &ldquo;wife&rdquo;&rsquo;s number, and execute the dial function with it as the argument. What about plenty of other tasks? We can&rsquo;t possibly hand-code each one.</p>

<p>Here&rsquo;s a slightly different approach: for every function we allow the bot to do, we only define the function and its needed arguments. For calling a number it&rsquo;d be <code class="prettyprint">function = dial, args = [number]</code>. With a knowledge base and autoplanning, the input &ldquo;call my wife&rdquo; will be parsed into <code class="prettyprint">function = dial</code>, <code class="prettyprint">args = [number]</code>. Since it&rsquo;s only given a <code class="prettyprint">person</code>, it can use the knowledge base to trace the connection <code class="prettyprint">person -[has]-&gt; number</code>, and proceed to retrieve the needed information from memory. The bot can use its own knowledge to plan and execute the function autonomously.</p>

<p>This is a pretty advanced feature that&rsquo;s still being implemented for AIVA. It is based on the theoretical proofs and outlines for a generic interface <a href="https://github.com/kengz/aiva/tree/master/docs/HTMI.md">HTMI</a> and a brain <a href="https://github.com/kengz/aiva/tree/master/docs/CGKB.md">CGKB</a>.</p>

<p>AIVA comes with 3 knowledge bases, from generic to local: </p>

<ul>
<li><a href="https://developers.google.com/knowledge-graph/">Google Knowledge Graph Search</a></li>
<li><a href="https://github.com/Planeshifter/node-concept-net">MIT ConceptNet</a></li>
<li>the local <a href="#graph-brain">neo4jKB brain</a>.</li>
</ul>

<blockquote>
<p>For now you can use Google Knowledge Graph directly to query knowledge. Note this is distinct from normal Google search:
<img alt="Google Knowledge Graph on Slack" src="./images/googlekg.png" /></p>
</blockquote>

<h2 id="neo4jkb-brain"><a name="#neo4jKB-brain"></a>Neo4jKB brain</h2>

<p>We discussed the <a href="#graph-brain">graph brain</a> above, known as <a href="https://github.com/kengz/neo4jKB"><code class="prettyprint">neo4jKB</code></a>, implemented in neo4j. It has a defined <a href="https://github.com/kengz/neo4jKB#kb-standard-basic">KB standard</a> on the graph for proper usage as a knowledge base.</p>

<p>This serves as the local knowledge and the central memory system. It is the reason AIVA can behave as one consistent entity across different chat platforms. All of the memory-dependent tasks shall be read from and write to the brain.</p>

<p>AIVA uses the brain for user serialization, standardized in <a href="https://github.com/kengz/aiva/tree/master/lib/js/user.js" target="_blank"><code>lib/js/user.js</code></a> and called automatically on start from <a href="https://github.com/kengz/aiva/tree/master/scripts/serialize_users.js" target="_blank"><code>scripts/serialize_users.js</code></a>. It will match up the multiple identities of a same user from different platforms. You can see all the serialized user nodes on neo4j&rsquo;s browser interface at <code class="prettyprint">http://localhost:7474/</code> if you are running locally, or use <a href="#ssh-browser-forwarding">SSH forwarding described here</a>.</p>

<blockquote>
<p>The serialized users in AIVA&rsquo;s neo4jKB graph brain:
<img alt="Users in brain" src="./images/serialized_users.png" /></p>
</blockquote>

<p>The todo list feature is another relevant example. The todo items are connected to their owner. The module logic for neo4jKB is defined in <a href="https://github.com/kengz/aiva/tree/master/lib/js/todo.js" target="_blank"><code>lib/js/todo.js</code></a>.</p>

<blockquote>
<p>The todos belonging to a user as connected unit of information, in AIVA&rsquo;s neo4jKB graph brain:
<img alt="User todos" src="./images/user_todo.png" /></p>
</blockquote>

<p>These two examples show briefly how to use neo4jKB for AIVA&rsquo;s modules, to help you get started. On our roadmap, we plan to complete the auto-parsing NLP module that automatically canonicalize knowledge from user input, so you don&rsquo;t have to write the define the knowledge yourself. This is closely related to the <strong>autoplanning</strong> of the <a href="#kbase">knowledge base feature</a>, and is part of <a href="https://github.com/kengz/aiva/tree/master/docs/HTMI.md">HTMI</a> and a brain <a href="https://github.com/kengz/aiva/tree/master/docs/CGKB.md">CGKB</a>.</p>

<p>See <a href="https://github.com/kengz/neo4jKB">neo4jKB</a> for documentation.</p>

<h2 id="google-apis"><a name="#google-api"></a>Google APIs</h2>

<p>Google APIs are grouped under the <code class="prettyprint">ai</code> module because many of them are actually AI or powered by AI. <a href="https://github.com/kengz/aiva/tree/master/lib/js/ais/google.js" target="_blank"><code>lib/js/ais/google.js</code></a> imports the <a href="https://github.com/google/google-api-nodejs-client">Google APIs Node.js client</a>. Not all of the APIs are initialized, you&rsquo;d have to activate each one as you wish to use on <a href="https://console.developers.google.com">Google API Manager</a> and in <code class="prettyprint">lib/js/ais/google.js</code>.</p>

<aside class="notice">
You must &ldquo;enable APIs&rdquo; from Google API Manager for your Google API key to use them.
</aside>

<p>We have seen Knowledge Graph Search earlier; Google Search actually uses a <a href="https://www.npmjs.com/package/google">npm module google</a> powered by a scraper, so it is free without quota. The interface script is at <a href="https://github.com/kengz/aiva/tree/master/scripts/google.js" target="_blank"><code>scripts/google.js</code></a>. Google Translate and language detection are also based on a scraper, in <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/ai_lib/translate.py" target="_blank"><code>lib/py/ais/ai_lib/translate.py</code></a> and is free without quota as well. The interface script is at <a href="https://github.com/kengz/aiva/tree/master/scripts/translate.js" target="_blank"><code>scripts/translate.js</code></a>.</p>

<p>See <a href="https://github.com/google/google-api-nodejs-client">google API Nodejs client</a> for their documentation.</p>

<h2 id="ibm-watson"><a name="watson"></a>IBM Watson</h2>

<p>IBM Watson is a collection of cognitive computing tools. AIVA&rsquo;s <code class="prettyprint">ai</code> module includes the IBM Watson Node.js client at <a href="https://github.com/kengz/aiva/tree/master/lib/js/ais/watson.js" target="_blank"><code>lib/js/ais/watson.js</code></a>.</p>

<p>To use Watson, you need to register at <a href="http://www.ibm.com/cloud-computing/bluemix/watson/">IBM Watson Bluemix</a>, activate the API you want, and get the individual credentials <code class="prettyprint">&lt;username&gt;:&lt;password&gt;</code>. Note that the credentials are distinct for each API you activate.</p>

<p>Then, add the credentials in <code class="prettyprint">bin/.keys-aiva</code> and <code class="prettyprint">bin/.keys-aivadev</code> with the format <code class="prettyprint">WATSON_&lt;API-NAME&gt;_CRED=&lt;username&gt;:&lt;password&gt;</code>, for example <code class="prettyprint">WATSON_PERSONALITY_INSIGHTS_CRED=&lt;username&gt;:&lt;password&gt;</code> for Personality Insights. The <a href="https://github.com/kengz/aiva/tree/master/lib/js/ais/watson.js" target="_blank"><code>lib/js/ais/watson.js</code></a> module will automatically read the environment variable and activate the function for your usage.</p>

<p>See the <a href="https://github.com/watson-developer-cloud/node-sdk">Watson node sdk</a> for their documentation.</p>

          <h1 id="adapters"><a name="adapters"></a>Adapters</h1>

<p>AIVA can simultaneously connect to multiple chat platforms and still behave as one entity, due to its central <a href="#neo4jKB-brain">graph brain</a>. This allows you to <strong>build once, run everywhere</strong>.</p>

<p>It utilizes <a href="https://github.com/github/hubot/blob/master/docs/adapters.md">hubot&rsquo;s adapters</a>. So, feel free to add any as you wish. AIVA comes with <strong>Slack, Telegram, Fb</strong> adapters, installed with <code class="prettyprint">npm run gi</code>, and auto-run with AIVA.</p>

<p>For each adapter, we encourage you to create two tokens, for <strong>production</strong> and <strong>development</strong> respectively. All bot tokens go into <a href="https://github.com/kengz/aiva/blob/master/bin/.keys-example" target="_blank"><code>bin/.keys-aiva or bin/.keys-aiva</code></a> created automatically during <code class="prettyprint">npm run gi</code>. If you do not wish to use an adapter, simple remove its token.</p>

<p>The webhooks for adapters are auto-set in <a href="#ngrok"><code class="prettyprint">ngrok</code></a> in <code class="prettyprint">index.js</code>; you don&rsquo;t even need to provide a webhook url.</p>

<p>As mentioned, we can use the custom message formatting of a platform, such as Slack attachment or Facebook rich messages. You can check the adapter by <code class="prettyprint">robot.adapterName</code> to format message accordingly, then send it using the method <code class="prettyprint">robot.adapter.customMessage</code> for any adapter. More below.</p>

<aside class="notice">
customMessage will be generalized soon - we are still working with the developers of the adapters, and will then provide better in-code examples.
</aside>

<h2 id="slack">Slack</h2>

<p><a href="https://github.com/slackhq/hubot-slack">hubot-slack</a> comes with AIVA. It uses Slack&rsquo;s RTC API. Create your bot and get the token <a href="https://my.slack.com/services/new/bot">here</a>, to set <a href="https://github.com/kengz/aiva/blob/master/bin/.keys-example#L2" target="_blank"><code>HUBOT_SLACK_TOKEN</code></a>.</p>

<p>To use customMessage, see the <a href="https://github.com/slackhq/hubot-slack/issues/170#issuecomment-113315455">example (pending update)</a>, invoked when <code class="prettyprint">robot.adapterName == &#39;slack&#39;</code>. Refer to the <a href="https://api.slack.com/docs/attachments">Slack attachments</a> for formatting.</p>

<h2 id="telegram">Telegram</h2>

<p><a href="https://github.com/lukefx/hubot-telegram">hubot-telegram</a> comes with AIVA. Create your bot and get the token <a href="https://core.telegram.org/bots#3-how-do-i-create-a-bot">here</a>, to set <a href="https://github.com/kengz/aiva/blob/master/bin/.keys-example#L3" target="_blank"><code>TELEGRAM_TOKEN</code></a>.</p>

<aside class="notice">
It&rsquo;s optional to provide a webhook url in bin/.keys-aiva with TELEGRAM_WEBHOOK; it is set up automatically in <a href="#ngrok"><code>index.js with ngrok</code></a>.
</aside>

<p>To use customMessage, see the <a href="https://github.com/lukefx/hubot-telegram#telegram-specific-functionality-ie-stickers-images">example</a>, invoked when <code class="prettyprint">robot.adapterName == &#39;telegram&#39;</code>. Refer to <a href="https://core.telegram.org/bots/api">Telegram bot API</a> for formatting.</p>

<h2 id="facebook">Facebook</h2>

<p><a href="https://github.com/chen-ye/hubot-fb">hubot-fb</a> comes with AIVA. Create your bot by creating a Fb App and Page, as detailed <a href="https://developers.facebook.com/docs/messenger-platform/quickstart">here</a>. Set the <a href="https://github.com/kengz/aiva/blob/master/bin/.keys-example#L4" target="_blank">keys</a> <code>FB_PAGE_ID, FB_APP_ID, FB_APP_SECRET, FB_PAGE_TOKEN</code> as explained in the adapter&rsquo;s page <a href="https://github.com/kengz/hubot-fb#configuration">hubot-fb</a>.</p>

<aside class="notice">
It&rsquo;s optional to provide a webhook url in bin/.keys-aiva with FB_WEBHOOK; it is set up automatically in <a href="#ngrok"><code>index.js with ngrok</code></a>.
</aside>

<aside class="warning">
Note that Facebook takes 10 mins to update webhook, so you may need to wait till then to start receiving messages. We advice using a persistent url in bin/.keys-aiva key FB_WEBHOOK, e.g. a Heroku url, or ngrok custom domain url; see <a href="#ngrok"><code>Tips on Webhook with ngrok</code></a>.
</aside>

<p>To use customMessage, see <a href="https://github.com/chen-ye/hubot-fb#sending-rich-messages-templates-images">the examples</a>, invoked when <code class="prettyprint">robot.adapterName == &#39;fb&#39;</code>. Refer to the <a href="https://developers.facebook.com/docs/messenger-platform/send-api-reference">Send API</a> for formatting.</p>

          <h1 id="development-guide"><a name="dev-guide"></a>Development Guide</h1>

<p>AIVA is created as an A.I. general purpose interface for developers. You can implement any features, use it simultaneously on the major platforms, and code in multiple languages. This solves the problem that many bots out there are are too specific, often bounded to one chat platform, and can only be developed in one language.</p>

<p>It has a NLP parser and KB brain out of the box. We take care of the crucial backend and system, so <em>developers can focus on things that matter</em>.</p>

<p>Since it is a generic interface, you can focus on writing your app/module. When done, plugging it into AIVA shall be way more trivial than writing a whole app with a MEAN stack or Rails to serve it.</p>

<h3 id="production-and-development">Production and Development</h3>

<p>Per common practice, we distinguish between production and development version using <code class="prettyprint">NODE_ENV</code> environment variables. So we generate two sets of keys for two bots:</p>

<aside class="success">
Use &ldquo;aiva&rdquo; for production, &ldquo;aivadev&rdquo; for development. They can coexist without system conflicts.
</aside>

<p>For Dockers, there are 2 containers: <code class="prettyprint">aiva-production</code> and <code class="prettyprint">aiva-development</code>, which provide good isolation. You can develop safely in parallel without needing to take down your deployed version.</p>

<h3 id="docker">Docker</h3>

<p>All the commands/scripts are compatible for use with/without Docker. The Docker image syncs the repo volume, so you can edit the source code and run the terminal commands as usual. The shell will enter a Docker container and run the same thing as it would on a local machine, so you can barely feel the difference when developing.</p>

<p>See <a href="#dockerization">Dockerization</a> for how AIVA is packaged into Docker.</p>

<p>The commands run Docker if the image <code class="prettyprint">kengz/aiva</code> is pulled, otherwise they run locally without entering a Docker container. We&rsquo;ll list them separately for clarity:</p>

<h3 id="commands-with-docker"><a name="commands"></a>Commands (with Docker)</h3>
<pre class="highlight shell"><code><span class="c"># All commands, uses `development` if not specified</span>
npm start <span class="c"># run aivadev (thru supervisord on Docker)</span>
npm start production <span class="c"># runs aiva</span>
<span class="c"># append `production` below as needed</span>
npm stop <span class="c"># stop the container along with the bots</span>
npm <span class="nb">test</span> <span class="c"># run unit tests</span>
npm run enter <span class="c"># enter a parallel bash session in the Docker container</span>
npm run reset <span class="c"># stop and remove the container</span>
</code></pre>

<aside class="notice">
<code>npm start</code> launches the primary bash session, which is used only for <code>supervisord</code>. Use <code>npm run enter</code> to launch parallel bash sessions for all other purposes.
</aside>

<h3 id="commands-without-docker">Commands (without Docker)</h3>

<p>On your local machine without containerization:</p>
<pre class="highlight shell"><code><span class="c"># All commands, uses `development` if not specified</span>
npm start <span class="c"># run aivadev</span>
npm start production <span class="c"># runs aiva</span>
<span class="c"># append `production` below as needed</span>
npm stop <span class="c"># stop the bots</span>
npm <span class="nb">test</span> <span class="c"># run unit tests</span>
forever list <span class="c"># see the list of bots running</span>
</code></pre>

<h3 id="custom-dependencies">Custom Dependencies</h3>

<p>The Docker containers on start will auto install any new dependencies specified in the right config files. They&rsquo;re listed in <a href="#project-dependencies">Project Dependencies</a>.</p>

<h2 id="polyglot-environment"><a name="polyglot"></a>Polyglot Environment</h2>

<p><strong>Unite we stand</strong>. Each language has its strengths, for example Python for machine learning, Node.js for web. With a built in <code class="prettyprint">Socket.io</code> client logic, AIVA allows you to write in multiple coordinating languages.</p>

<p>For now we have <code class="prettyprint">/lib/client.{js, py, rb}</code>. Feel free to add <code class="prettyprint">Socket.io</code> client for more languages through pull request!</p>

<blockquote>
<p>For quick multilingual dev, you can start the <strong>polyglot server</strong> at <code class="prettyprint">lib/io_start.js</code> with:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># shell: start the polyglot server</span>
npm run server
</code></pre>

<aside class="warning">
This is automatically run with <code>npm run</code>, so don&rsquo;t manual-run it before starting the bot.
</aside>

<blockquote>
<p>then import a <code class="prettyprint">lib/client.js</code> to test a local feature from the <code class="prettyprint">js</code> interface. Example: the snippet at the top of <a href="https://github.com/kengz/aiva/blob/master/scripts/translate.js#L5" target="_blank"><code>scripts/translate.js</code></a> quickly tests the translate function in <code class="prettyprint">python</code>. Uncomment and run it.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/translate.js</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="s2">"hola amigos"</span><span class="p">,</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'nlp.py'</span><span class="p">,</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'translate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// hello friends</span>
</code></pre>

<aside class="success">
For development like above, <a href="https://github.com/kengz/aiva/tree/master/lib/client.js#L85" target="_blank"><code>lib/client.js</code></a> will automatically set the environment variables using <code>bin/.keys-aivadev</code> if not already.
</aside>

<h2 id="polyglot-development"><a name="polyglot-dev"></a>Polyglot Development</h2>

<p>The quickest way to get into dev is to look at the examples in <code class="prettyprint">lib/&lt;lang&gt;/</code> and <code class="prettyprint">scripts/</code>, which we will go over now.</p>

<p>Development comes down to:</p>

<ul>
<li><strong>module</strong>: callable low level functions, lives in <code class="prettyprint">/lib/&lt;lang&gt;/&lt;module&gt;.&lt;lang&gt;</code>.</li>
<li><strong>interface</strong>: high level user interface to call the module functions, lives in <code class="prettyprint">/scripts/&lt;interface&gt;.js</code></li>
</ul>

<p>The module can be written in any language if it has a Socket.io client. The interface is in <code class="prettyprint">js</code>, and that&rsquo;s pretty easy to write.</p>

<aside class="notice">
It is vital to follow the <a href="#project-dir">directory structure</a> to expose them to socket.io as it calls from <code>lib/&lt;lang&gt;/*</code> but not deeper. You can import nested modules from there and call it with dot-path. More on this later.
</aside>

<p>You write a module in <code class="prettyprint">&lt;lang&gt;</code>, how do you call it from the interface? There are 3 cases depending on the number of <code class="prettyprint">&lt;lang&gt;</code> (including <code class="prettyprint">js</code> for interface) involved.</p>

<h3 id="case-1-lt-lang-gt">Case: 1 <code class="prettyprint">&lt;lang&gt;</code></h3>

<p><code class="prettyprint">&lt;lang&gt; = js</code>. If your module is in <code class="prettyprint">js</code>, just <code class="prettyprint">require</code> it directly in the interface script.</p>

<aside class="notice">
Since the AIVA is based on hubot, you can refer to <a href="https://github.com/github/hubot/blob/master/docs/scripting.md">hubot scripting guide</a>. You can also <a href="https://github.com/github/hubot/blob/master/docs/scripting.md#script-loading">load hubot scripts</a> written by others.
</aside>

<h3 id="case-2-lt-lang-gt-s">Case: 2 <code class="prettyprint">&lt;lang&gt;</code>s</h3>

<p>e.g. <code class="prettyprint">&lt;lang&gt; = js, py</code>. </p>

<p>1. You write a module <a href="https://github.com/kengz/aiva/tree/master/lib/py/hello.py" target="_blank"><code>lib/py/hello.py</code></a></p>

<p>2. Call it from the interface <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a> using the exposed <code class="prettyprint">global.gPass</code> function, with the JSON <code class="prettyprint">msg</code></p>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_py.js</span>
<span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">input</span><span class="p">:</span> <span class="s1">'Hello from user.'</span><span class="p">,</span> <span class="c1">// input for module function</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'hello.py'</span><span class="p">,</span> <span class="c1">// the target module</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'sayHi'</span> <span class="c1">// the module function to call with input</span>
  <span class="c1">// add more as needed</span>
<span class="p">}</span>
</code></pre>

<p>3. Ensure the called module function returns a reply JSON to the interface:</p>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'output'</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'input'</span><span class="p">)),</span> <span class="c"># output to interface</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># is 'client.js' for interface</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="c"># 'hello.py'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span> <span class="c"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<p>The JSON fields above are required for their purposes. <code class="prettyprint">global.gPass</code> used by the interface will auto-inject and <code class="prettyprint">id</code> for reply, and a <code class="prettyprint">hash</code> to resolve the promise for the interface.</p>

<blockquote>
<p>The hello_py feature calls Python; on Telegram:
<img alt="hello_py on Telegram" src="./images/hello_py.png" /></p>
</blockquote>

<h3 id="case-3-lt-lang-gt-s">Case: 3 <code class="prettyprint">&lt;lang&gt;</code>s</h3>

<p>e.g. <code class="prettyprint">&lt;lang&gt; = js, py, rb</code></p>

<p>1. You write modules in <code class="prettyprint">py, rb</code> <a href="https://github.com/kengz/aiva/tree/master/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a>, <a href="https://github.com/kengz/aiva/tree/master/lib/rb/Hello.rb" target="_blank"><code>lib/rb/Hello.rb</code></a></p>

<p>2. Call one (<code class="prettyprint">py</code> in this example) from the interface <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_py_rb.js" target="_blank"><code>scripts/hello_py_rb.js</code></a> as described earlier.</p>

<p>3. <a href="https://github.com/kengz/aiva/tree/master/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a> passes it further to the <code class="prettyprint">rb</code> module, by returning the JSON <code class="prettyprint">msg</code></p>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello_rb.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'input'</span><span class="p">:</span> <span class="s">'Hello from Python from js.'</span><span class="p">,</span> <span class="c"># input for rb module function</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="s">'Hello.rb'</span><span class="p">,</span> <span class="c"># the target module</span>
  <span class="s">'intent'</span><span class="p">:</span> <span class="s">'sayHi'</span><span class="p">,</span> <span class="c"># the module function to call with input</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># pass on 'client.js'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">),</span> <span class="c"># pass on callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<p>4. <a href="https://github.com/kengz/aiva/tree/master/lib/rb/Hello.rb" target="_blank"><code>lib/rb/Hello.rb</code></a> ensure the final module function returns a reply JSON <code class="prettyprint">msg</code> to the interface. </p>

<aside class="warning">
For auto-id, Ruby filename need to be the same as its module name, case-sensitive.
</aside>
<pre class="highlight ruby"><code><span class="c1"># rb: lib/rb/Hello.rb</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'output'</span> <span class="o">=&gt;</span> <span class="s1">'Hello from Ruby.'</span><span class="p">,</span> <span class="c1"># output to interface</span>
  <span class="s1">'to'</span> <span class="o">=&gt;</span> <span class="n">msg</span><span class="p">[</span><span class="s1">'from'</span><span class="p">],</span> <span class="c1"># 'client.js'</span>
  <span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="vc">@@id</span><span class="p">,</span> <span class="c1"># 'Hello.rb'</span>
  <span class="s1">'hash'</span> <span class="o">=&gt;</span> <span class="n">msg</span><span class="p">[</span><span class="s1">'hash'</span><span class="p">]</span> <span class="c1"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>The hello_py_rb feature calls Python then Ruby; on Slack:
<img alt="hello_py_rb on Slack" src="./images/hello_py_rb.png" /></p>
</blockquote>

<h3 id="dev-pattern">Dev pattern</h3>

<p>With such pattern, you can chain multiple function calls that bounce among different <code class="prettyprint">&lt;lang&gt;</code>. Example use case: retrieve data from Ruby on Rails app, pass to Java to run algorithms, then to Python for data analysis, then back to Node.js interface.</p>

<aside class="success">
The generic advice: ensure that your functions return the correct JSON <code>msg</code>, and we handle the inter-language dataflow logic. See the <a href="#msg-json"><code>msg</code> JSON keys</a>.
</aside>

<h3 id="quot-ma-look-no-hand-ler-s-quot">&ldquo;Ma look! No hand(ler)s!&rdquo;</h3>

<p>&ldquo;Do I really have to add a handler to reply a JSON <code class="prettyprint">msg</code> for <strong>every</strong> function I call?&rdquo;. That&rsquo;s really cumbersome. </p>

<p>To streamline polyglot development further we&rsquo;ve made the <code class="prettyprint">client.&lt;lang&gt;</code>&rsquo;s automatically try to compile a proper reply JSON <code class="prettyprint">msg</code>, using the original <code class="prettyprint">msg</code> it receives for invoking a function.</p>

<p>What this means is you can call a <strong>module</strong> (<code class="prettyprint">to</code>) by its name, and its <strong>function</strong> (<code class="prettyprint">intent</code>) by specifying the dotpath (if it&rsquo;s nested), then providing a valid <code class="prettyprint">input</code> format (single argument for now).</p>

<p>In fact, <a href="https://github.com/kengz/aiva/tree/master/scripts/translate.js" target="_blank"><code>scripts/translate.js</code></a> does just that. It uses Socket.io to call the <a href="https://github.com/kengz/aiva/tree/master/lib/py/nlp.py" target="_blank"><code>lib/py/nlp.py</code></a>, which imports <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/ai_lib/translate.py" target="_blank"><code>lib/py/ais/ai_lib/translate.py</code></a></p>

<blockquote>
<p>To test-run it, you can start the <strong>polyglot server</strong> at <code class="prettyprint">lib/io_start.js</code> with:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># shell: start the polyglot server</span>
npm run server
</code></pre>

<blockquote>
<p>Uncomment the snippet at the top of <a href="https://github.com/kengz/aiva/blob/master/scripts/translate.js#L5" target="_blank"><code>scripts/translate.js</code></a> and run it.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/translate.js</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="s2">"hola amigos"</span><span class="p">,</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'nlp.py'</span><span class="p">,</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'translate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// hello friends</span>
</code></pre>

<blockquote>
<p>This calls <a href="https://github.com/kengz/aiva/tree/master/lib/py/nlp.py" target="_blank"><code>lib/py/nlp.py</code></a> that imports <a href="https://github.com/kengz/aiva/tree/master/lib/py/ais/ai_lib/translate.py" target="_blank"><code>lib/py/ais/ai_lib/translate.py</code></a>, which returns the translated string instead of a reply JSON. The client will auto-compile a proper reply JSON msg for you.</p>
</blockquote>
<pre class="highlight python"><code><span class="c"># py: lib/py/ais/ai_lib/translate.py</span>
<span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s">"en"</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">from_lang</span><span class="o">=</span><span class="s">"auto"</span><span class="p">,</span> <span class="n">to_lang</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</code></pre>

<blockquote>
<p>The translate feature calls Python that returns string that is auto-compiled into JSON msg by client.py; on Slack:
<img alt="translate on Slack" src="./images/translate.png" /></p>
</blockquote>

<p>On receiving a <code class="prettyprint">msg</code>, the <code class="prettyprint">client.&lt;lang&gt;</code> tries to call the function by passing <code class="prettyprint">msg</code>. If that throws an exception, it retries by passing <code class="prettyprint">msg.input</code>. After the function executes and returns the result, <code class="prettyprint">client.&lt;lang&gt;</code>&rsquo;s handler will check if the reply is a valid JSON, and if not, will make it into one via <code class="prettyprint">correctJSON(reply, msg)</code> by extracting the information needed from the received <code class="prettyprint">msg</code>.</p>

<p>Lastly, after the <code class="prettyprint">js</code> <code class="prettyprint">global.gPass</code> sends out a <code class="prettyprint">msg</code>, the final reply directed at it should contain an <code class="prettyprint">output</code> field, as good dev pattern and reliability in promise-resolution. When <code class="prettyprint">global.gPass(msg)</code> gets its reply and its promise resolved, you will see <code class="prettyprint">hasher.handle invoking cb</code> in stdout.</p>

<aside class="notice">
In fact, once we finish the NLP auto-parsing feature for user sentences, we wouldn&rsquo;t even need to write an interface; This is still under work.
</aside>

<h2 id="unit-tests">Unit Tests</h2>

<p><a href="https://travis-ci.org/kengz/aiva"><img alt="Build Status" src="https://travis-ci.org/kengz/aiva.svg?branch=aiva-v3" /></a> <a href="https://coveralls.io/github/kengz/aiva?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/kengz/aiva/badge.svg?branch=aiva-v3" /></a></p>

<p>This repo includes only unit tests for <code class="prettyprint">js</code> <strong>modules</strong> and <strong>interface</strong> scripts using <code class="prettyprint">mocha</code>, and runs with <code class="prettyprint">npm test</code>. Note that tests should be for systems, thus the tests for AI models are excluded.</p>

<p>For the module of other <code class="prettyprint">&lt;lang&gt;</code>, you may add any unit testing framework of your choice.</p>

<h2 id="how-it-works-socket-io-logic-and-standard">How it works: Socket.io logic and standard</h2>

<h3 id="msg-json-keys-for-different-purposes"><a name="msg-json"></a><code class="prettyprint">msg</code> JSON keys for different purposes.</h3>

<ul>
<li>to call a module&rsquo;s function in <code class="prettyprint">&lt;lang&gt;</code>: <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a></li>
</ul>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/hello_py.js</span>
<span class="nx">msg</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">input</span><span class="p">:</span> <span class="s1">'Hello from user.'</span><span class="p">,</span> <span class="c1">// input for module function</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'hello.py'</span><span class="p">,</span> <span class="c1">// the target module</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'sayHi'</span> <span class="c1">// the module function to call with input</span>
  <span class="c1">// add more as needed</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>to reply the payload to sender: <a href="https://github.com/kengz/aiva/tree/master/lib/py/hello.py" target="_blank"><code>lib/py/hello.py</code></a></li>
</ul>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'output'</span><span class="p">:</span> <span class="n">foo</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'input'</span><span class="p">)),</span> <span class="c"># output to interface</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># is 'client.js' for interface</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="c"># 'hello.py'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">)</span> <span class="c"># callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<ul>
<li>to pass on payload to other module&rsquo;s function: <a href="https://github.com/kengz/aiva/tree/master/lib/py/hello_rb.py" target="_blank"><code>lib/py/hello_rb.py</code></a></li>
</ul>
<pre class="highlight python"><code><span class="c"># py: lib/py/hello_rb.py</span>
<span class="n">reply</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'input'</span><span class="p">:</span> <span class="s">'Hello from Python from js.'</span><span class="p">,</span> <span class="c"># input for rb module function</span>
  <span class="s">'to'</span><span class="p">:</span> <span class="s">'Hello.rb'</span><span class="p">,</span> <span class="c"># the target module</span>
  <span class="s">'intent'</span><span class="p">:</span> <span class="s">'sayHi'</span><span class="p">,</span> <span class="c"># the module function to call with input</span>
  <span class="s">'from'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'from'</span><span class="p">),</span> <span class="c"># pass on 'client.js'</span>
  <span class="s">'hash'</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'hash'</span><span class="p">),</span> <span class="c"># pass on callback hash for interface</span>
<span class="p">}</span>
</code></pre>

<h3 id="msg-json-keys"><code class="prettyprint">msg</code> JSON keys</h3>

<table><thead>
<tr>
<th style="text-align: left">key</th>
<th>details</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">input</td>
<td>input to the target module function.</td>
</tr>
<tr>
<td style="text-align: left">to</td>
<td>filename of the target module in <code class="prettyprint">lib/&lt;lang&gt;</code>.</td>
</tr>
<tr>
<td style="text-align: left">intent</td>
<td>function of the target module to call. Call nested function with dot-path, e.g. <code class="prettyprint">nlp.translate</code>.</td>
</tr>
<tr>
<td style="text-align: left">output</td>
<td>output from the target function to reply with.</td>
</tr>
<tr>
<td style="text-align: left">from</td>
<td>ID of the script sending the <code class="prettyprint">msg</code>.</td>
</tr>
<tr>
<td style="text-align: left">hash</td>
<td>auto-generated callback-promise hash from <code class="prettyprint">client.js</code> to callback interface.</td>
</tr>
</tbody></table>

<p>Of course, add additional keys to the JSON as needed by your function.</p>

<aside class="notice">
Overall, ensure that your functions return the correct JSON `msg`, and we handle the inter-language dataflow logic.
</aside>

<aside class="success">
Socket.io can send deeply nested JSON with standard data type.
</aside>

<h3 id="server">Server</h3>

<p>There is a socket.io server that extends Hubot&rsquo;s Express.js server: <a href="https://github.com/kengz/aiva/tree/master/lib/io_server.js" target="_blank"><code>lib/io_server.js</code></a>. All <code class="prettyprint">msg</code>s go through it. For example, let <code class="prettyprint">msg.to = &#39;hello.py&#39;, msg.intent = &#39;sayHi&#39;</code>. The server splits this into <code class="prettyprint">module = &#39;hello&#39;, lang = &#39;py&#39;</code>, modifies <code class="prettyprint">msg.to = module</code>, then sends the <code class="prettyprint">msg</code> to the client of <code class="prettyprint">lang</code>.</p>

<blockquote>
<p>For quick multilingual dev, you can start the <strong>polyglot server</strong> at <code class="prettyprint">lib/io_start.js</code> with:</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># shell: start the polyglot server</span>
npm run server
</code></pre>

<aside class="warning">
This is automatically with <code>npm run</code>, so don&rsquo;t manual-run it before starting the bot.
</aside>

<h3 id="clients"><a name="clients"></a>Clients</h3>

<p>For each language, there is a socket.io client that imports all modules of its language within <code class="prettyprint">lib</code>. When server sends a <code class="prettyprint">msg</code> to it, the client&rsquo;s <code class="prettyprint">handle</code> will find the module and its function using <code class="prettyprint">msg.to, msg.intent</code> respectively, then call the function with <code class="prettyprint">msg</code> as the argument. If it gets a valid reply <code class="prettyprint">msg</code>, it will pass it on to the server.</p>

<blockquote>
<p>then import a <code class="prettyprint">lib/client.js</code> to test a local feature from the <code class="prettyprint">js</code> interface. Example: the snippet at the top of <a href="https://github.com/kengz/aiva/blob/master/scripts/translate.js#L5" target="_blank"><code>scripts/translate.js</code></a> quickly tests the translate function in <code class="prettyprint">python</code>. Uncomment and run it.</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// js: scripts/translate.js</span>
<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../client.js'</span><span class="p">)</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">gPass</span>

<span class="nx">global</span><span class="p">.</span><span class="nx">gPass</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="s2">"hola amigos"</span><span class="p">,</span>
  <span class="na">to</span><span class="p">:</span> <span class="s1">'nlp.py'</span><span class="p">,</span>
  <span class="na">intent</span><span class="p">:</span> <span class="s1">'translate'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
<span class="c1">// hello friends</span>
</code></pre>

<aside class="success">
For development like above, <a href="https://github.com/kengz/aiva/tree/master/lib/client.js#L85" target="_blank"><code>lib/client.js</code></a> will automatically set the environment variables using <code>bin/.keys-aivadev</code> if not already.
</aside>

<blockquote>
<p>Note due to how a module is called using <code class="prettyprint">msg.to, msg.intent</code>, you must ensure that the functions are named properly, and <code class="prettyprint">Ruby</code>&rsquo;s requirement that module be capitalized implies that you have to name the file with the same capitalization, e.g. <code class="prettyprint">lib/rb/Hello.rb</code> for the <code class="prettyprint">Hello</code> module.</p>
</blockquote>

<p>We now support <code class="prettyprint">node.js, python, ruby</code>.</p>

<aside class="notice">
To add support for other language, say Java, you can add a <code>lib/client.java</code> by following patterns in <code>lib/client.{py, rb}</code>, and starting them in <code>lib/io_client.js</code>. Please create a pull request if you do so :)
</aside>

<h3 id="entry-point">Entry point</h3>

<p>The entry point is always a <code class="prettyprint">js</code> interface script, but luckily we have made it trivial for non-js developers to write it. A full reference is <a href="https://github.com/github/hubot/blob/master/docs/scripting.md">hubot scripting guide</a>.</p>

<p><code class="prettyprint">robot.respond</code> takes a regex and a callback function, which executes when the regex matches the string the robot receives. <code class="prettyprint">res.send</code> is the primary method we use to send a string to the user.</p>

<p>Overall, there are 2 ways to connect with <code class="prettyprint">lib</code> modules:</p>

<p><strong>global.gPass</strong>: <a href="https://github.com/kengz/aiva/tree/master/scripts/hello_py.js" target="_blank"><code>scripts/hello_py.js</code></a> This is a global method to pass a <code class="prettyprint">msg</code>. It generates a <code class="prettyprint">hash</code> using <code class="prettyprint">lib/hasher.js</code> with a <code class="prettyprint">Promise</code>, which is resolved whenever the <code class="prettyprint">js</code> client receives a valid reply <code class="prettyprint">msg</code> with same <code class="prettyprint">hash</code>. This method returns the resolved <code class="prettyprint">Promise</code> with that <code class="prettyprint">msg</code> for chaining.</p>

<p><strong>wrapped global.gPass</strong>: <a href="https://github.com/kengz/aiva/tree/master/scripts/translate.js" target="_blank"><code>scripts/translate.js</code></a>, <a href="https://github.com/kengz/aiva/tree/master/lib/js/nlp.js" target="_blank"><code>lib/js/nlp.js</code></a> This is similar to above, but the <code class="prettyprint">msg</code> is properly generated by a <code class="prettyprint">js</code> lib module, resulting in a much cleaner and safer interface script. The lib module needs to be imported at the top to be used.</p>

<h3 id="data-flow">Data flow</h3>

<p>The msg goes through socket.io as </p>

<ul>
<li><code class="prettyprint">js(interface script)</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; &lt;lang&gt;(client.&lt;lang&gt;)</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; ...(can bounce among different &lt;lang&gt; modules)</code></li>
<li><code class="prettyprint">-&gt; js(client.js)</code></li>
<li><code class="prettyprint">-&gt; js(interface script)</code></li>
</ul>

<p>For the <code class="prettyprint">hello_py.js</code> example, the path is </p>

<ul>
<li><code class="prettyprint">js(scripts/hello_py.js) user input</code></li>
<li><code class="prettyprint">-&gt; js(lib/io_server.js)</code></li>
<li><code class="prettyprint">-&gt; py(client.py), call py function</code></li>
<li><code class="prettyprint">-&gt; js(io_server.js)</code></li>
<li><code class="prettyprint">-&gt; js(client.js) call Promise.resolve</code></li>
<li><code class="prettyprint">-&gt; js(interface script) send back to user</code></li>
</ul>

<h2 id="project-directory-structure"><a name="project-dir"></a>Project directory structure</h2>

<p>What goes where:</p>

<table><thead>
<tr>
<th style="text-align: left">Folder/File</th>
<th>Purpose</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">bin/</td>
<td>bot keys, binaries, bash setup scripts.</td>
</tr>
<tr>
<td style="text-align: left">lib/&lt;lang&gt;/</td>
<td>Module scripts, grouped by language, callable via socket.io. See <a href="#polyglot-dev">Polyglot Development</a>.</td>
</tr>
<tr>
<td style="text-align: left">lib/client.&lt;lang&gt;</td>
<td>Import all scripts from <code class="prettyprint">lib/&lt;lang&gt;/</code> and expose them to socket.io for cross-language communication.</td>
</tr>
<tr>
<td style="text-align: left">lib/io_start.js</td>
<td>socket.io server and client logic for cross-language communication.</td>
</tr>
<tr>
<td style="text-align: left">logs</td>
<td>Logs from bot for debugging and healthcheck.</td>
</tr>
<tr>
<td style="text-align: left">scripts</td>
<td>The <code class="prettyprint">node.js</code> user interface for the <code class="prettyprint">lib/</code> modules.</td>
</tr>
<tr>
<td style="text-align: left">scripts/_init.js</td>
<td>Kicks off AIVA setups after the base Hubot is constructed, before other scripts are lodaded.</td>
</tr>
<tr>
<td style="text-align: left">test</td>
<td>Unit tests; uses Mocha.</td>
</tr>
<tr>
<td style="text-align: left">.env</td>
<td>Non-bot-specific environment variables.</td>
</tr>
<tr>
<td style="text-align: left">external-scripts.json</td>
<td>You can <a href="https://github.com/github/hubot/blob/master/docs/scripting.md#script-loading">load Hubot npm modules</a> by specifying them in here and <code class="prettyprint">package.json</code>.</td>
</tr>
</tbody></table>

          <h1 id="setup-tips"><a name="setup-tips"></a>Setup tips</h1>

<h2 id="docker-installation"><a name="docker-installation"></a>Docker installation</h2>

<p><a href="https://www.docker.com/">Docker</a> is a nice way to package and distribute complex modules, it also allows you to develop in safe isolated environment with containerization. </p>

<p>The <a href="https://hub.docker.com/r/kengz/aiva/">AIVA Docker image</a> (2Gb) comes ready-to-run for the repo source code. It includes all the needed components, e.g. the runtimes (nodejs, python, ruby, Java), Neo4j, the ML modules (Tensorflow, scikitlearn, scipy, numpy, spacy etc.). Depending on which OS you use, the setups are easy:</p>

<h3 id="ubuntu">Ubuntu</h3>

<ul>
<li>Digital Ocean: The easiest, using their <a href="https://www.digitalocean.com/features/one-click-apps/docker/">Docker 1-click app on Ubuntu</a>. Docker comes installed with it.</li>
<li>Ubuntu from scratch: See <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-16-04">this guide</a> by Digital Ocean.</li>
</ul>

<p>Then, you need <code class="prettyprint">nodejs</code> to run basic setup for entering Docker.</p>
<pre class="highlight shell"><code><span class="c"># Nodejs</span>
curl -sL https://deb.nodesource.com/setup_6.x | bash -
sudo apt-get install -y nodejs
</code></pre>

<p>If your Digital Ocean instance has insufficient swap memory, boost it:</p>
<pre class="highlight shell"><code><span class="c"># Ensure you have enough swap memory. Typically you'd have to run this</span>
<span class="c"># Setting 1Gb swap space.</span>
swapoff -a
sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/swapfile <span class="nv">bs</span><span class="o">=</span>1024 <span class="nv">count</span><span class="o">=</span>1024k
sudo mkswap /swapfile
sudo swapon /swapfile
swapon -s
</code></pre>

<h3 id="mac-osx">Mac OSX</h3>

<p>Mac needs a VM driver on top to run Docker. Here&rsquo;s the complete Docker installation, with <code class="prettyprint">nodejs</code></p>
<pre class="highlight shell"><code><span class="c"># Install Homebrew</span>
ruby -e <span class="s2">"</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">"</span>
<span class="c"># Install Cask</span>
brew install caskroom/cask/brew-cask
<span class="c"># Install docker toolbox</span>
brew cask install dockertoolbox

<span class="c"># create the docker machine. Note that 'default' is the vm name we will be using</span>
docker-machine create --driver virtualbox default
<span class="c"># allocate resource for the docker machine when stopped</span>
VBoxManage modifyvm default --cpus 2 --memory 4096
docker-machine start default

<span class="c"># to use vm in terminal</span>
<span class="nb">echo</span> <span class="s1">'eval "$(docker-machine env default)"'</span> &gt;&gt; ~/.bash_profile
<span class="nb">source</span> ~/.bash_profile

<span class="c"># Nodejs</span>
brew install node
npm update npm -g
</code></pre>

<h2 id="system-dependencies"><a name="dependencies"></a>System Dependencies</h2>

<p>Though not advised, you can skip Docker and develop on your machine directly without containerization. </p>

<ul>
<li>Use this automatic <a href="https://github.com/kengz/mac_setup">setup script</a> for Ubuntu and MacOSX, </li>
<li>run <a href="https://github.com/kengz/aiva/tree/master/bin/install" target="_blank"><code>bin/install</code></a>. </li>
<li>run <code class="prettyprint">npm run gi</code></li>
</ul>

<p>These install all the system and project dependencies automatically. There is a lot of components listed there for your inspection.</p>

<h2 id="project-dependencies"><a name="project-dependencies"></a>Project Dependencies</h2>

<p>You can save your project dependencies:</p>

<ul>
<li><code class="prettyprint">package.json</code> for <code class="prettyprint">node.js</code></li>
<li><code class="prettyprint">requirements.txt</code> for <code class="prettyprint">python</code></li>
<li><code class="prettyprint">Gemfile</code> for <code class="prettyprint">ruby</code></li>
</ul>

<p>and the Docker container autoruns the installation script on every start: <code class="prettyprint">npm run gi</code> runs the following in sequence:</p>

<ul>
<li><code class="prettyprint">npm install</code></li>
<li><code class="prettyprint">pip3 install -r requirements.txt</code></li>
<li><code class="prettyprint">bundle install</code></li>
</ul>

<p>If you&rsquo;re not using Docker, you need to run <code class="prettyprint">npm run gi</code> manually.</p>

<h2 id="custom-deployment">Custom deployment</h2>

<p>All bot deployment commands are wrapped with <code class="prettyprint">npm</code> inside <code class="prettyprint">package.json</code>. For more novice users, you can customize the <code class="prettyprint">scripts</code> in <code class="prettyprint">package.json</code>. For example, changing &ldquo;aiva&rdquo; and &ldquo;aivadev&rdquo; to your bot name of choice.</p>

<h2 id="different-botname">Different Botname</h2>

<p>If you prefer a different bot name, replace &ldquo;aiva&rdquo; from the <code class="prettyprint">bin/.keys-</code> and in <code class="prettyprint">package.json</code>.</p>

<p>Sometimes you just can&rsquo;t use the bot name across platforms - maybe it&rsquo;s already taken, or they require a &ldquo;bot&rdquo; word be added to it. </p>

<p>For all adapters, <code class="prettyprint">process.env.BOTNAME</code> defaults to the name after &ldquo;-&rdquo; in <code class="prettyprint">.keys-&lt;botname&gt;</code>. You can change this by providing in there an env variable <code class="prettyprint">&lt;ADAPTER&gt;_BOTNAME</code>, e.g. <code class="prettyprint">TELEGRAM_BOTNAME=AIVAthebot</code>.</p>

<h2 id="monitoring">Monitoring</h2>

<p>AIVA uses [<code class="prettyprint">supervisord</code>] with Docker, and <a href="https://github.com/foreverjs/forever"><code class="prettyprint">forever</code></a> without Docker. Either way, the bot logs are written to <code class="prettyprint">logs/</code>.</p>

<p>Additionally, the non-bot logs are written to <code class="prettyprint">/var/log/</code> for <code class="prettyprint">supervisor</code>, <code class="prettyprint">nginx</code> and <code class="prettyprint">neo4j</code> in Docker.</p>

<h2 id="dockerization"><a name="dockerization"></a>Dockerization</h2>

<aside class="notice">
Advanced users can use this section to configure and extend AIVA.
</aside>

<p>With some spirit of try-hard devops, we package the Docker image so it follows common deployment practices. Below are the primary processes that are ran in the Docker container, and the relevant config files. They package the original AIVA that is ran on a local machine into Docker.</p>

<ul>
<li><code class="prettyprint">supervisord</code>, with <code class="prettyprint">bin/supervisord.conf</code>: The main entry-point process that runs everything else. Logs output to the main bash session started by <code class="prettyprint">npm start</code></li>
<li><code class="prettyprint">nginx</code>, with <code class="prettyprint">bin/nginx.conf</code>: Helps expose the Docker port to the host machine and the outside world. See <a href="#docker-port">Docker Port-forwarding</a> for how it&rsquo;s done.</li>
</ul>

<p>Helper bash scripts for running <a href="#commands">Commands</a>;</p>

<ul>
<li><code class="prettyprint">bin/start.sh</code> ran by <code class="prettyprint">npm start</code>: start a container in <code class="prettyprint">production</code> or <code class="prettyprint">development</code> environment, with the primary bash session to use <code class="prettyprint">supervisord</code> only.</li>
<li><code class="prettyprint">bin/enter.sh</code> ran by <code class="prettyprint">npm run enter</code>: start a parallel non-primary bash session to enter the container.</li>
<li><code class="prettyprint">bin/stop.sh</code> ran by <code class="prettyprint">npm stop</code>: stop a container and the bot inside.</li>
<li><code class="prettyprint">bin/reset.sh</code> ran by <code class="prettyprint">npm run reset</code>: stop and remove a container, so you can create a fresh one with <code class="prettyprint">npm start</code> if shit goes wrong.</li>
</ul>

<h2 id="docker-port-forwarding"><a name="docker-port"></a>Docker Port-forwarding</h2>

<p>In the uncommon case where you need to expose a port from Docker, there are 4 steps:</p>

<ul>
<li>EXPOSE the port and its suggorate in <code class="prettyprint">bin/Dockerfile</code>, then rebuild the Docker image for changes to apply.</li>
<li>define the reverse proxy for the port following the pattern in <code class="prettyprint">bin/nginx.conf</code></li>
<li>for MacOSX, add the ports for host-container port forwarding by Virtualbox in <code class="prettyprint">bin/start.sh</code> above <code class="prettyprint">VBoxManage controlvm ...</code></li>
<li>publish the Docker port in <code class="prettyprint">bin/start.sh</code> at <code class="prettyprint">docker run ... -p &lt;hostport&gt;:&lt;containerport&gt;</code></li>
</ul>

<h2 id="webhook-using-ngrok"><a name="ngrok"></a>Webhook using ngrok</h2>

<p>You don&rsquo;t need to specify any webhook urls; they are set up automatically in <a href="https://github.com/kengz/aiva/blob/master/index.js#L86" target="_blank"><code>index.js with ngrok</code></a>. Access the ngrok interface at <a href="http://localhost:4040"><code class="prettyprint">http://localhost:4040</code></a> (production) or <a href="http://localhost:4041"><code class="prettyprint">http://localhost:4041</code></a> (development) after AIVA is run.</p>

<p>Note that for each adapter, if it needs a webhook, you need to specify the <code class="prettyprint">PORT</code> and the environment key for the webhook, at the top of <a href="https://github.com/kengz/aiva/blob/master/index.js" target="_blank"><code>index.js</code></a> in variables <code class="prettyprint">adapterPorts</code>, <code class="prettyprint">adapterWebhookKey</code>.</p>
<pre class="highlight javascript"><code><span class="c1">// js: index.js</span>
<span class="c1">// list of all ports used, including for adapters</span>
<span class="kd">var</span> <span class="nx">portList</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">production</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">ngrok</span><span class="p">:</span> <span class="s1">'4040-4041'</span><span class="p">,</span>
    <span class="na">neo4j</span><span class="p">:</span> <span class="mi">7474</span><span class="p">,</span>
    <span class="na">socketIO</span><span class="p">:</span> <span class="mi">6464</span><span class="p">,</span>
    <span class="na">slack</span><span class="p">:</span> <span class="mi">8343</span><span class="p">,</span>
    <span class="na">telegram</span><span class="p">:</span> <span class="mi">8443</span><span class="p">,</span>
    <span class="na">fb</span><span class="p">:</span> <span class="mi">8543</span>
  <span class="p">},</span>
  <span class="na">development</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">ngrok</span><span class="p">:</span> <span class="s1">'4040-4041'</span><span class="p">,</span>
    <span class="na">neo4j</span><span class="p">:</span> <span class="mi">7476</span><span class="p">,</span>
    <span class="na">socketIO</span><span class="p">:</span> <span class="mi">6466</span><span class="p">,</span>
    <span class="na">slack</span><span class="p">:</span> <span class="mi">8345</span><span class="p">,</span>
    <span class="na">telegram</span><span class="p">:</span> <span class="mi">8443</span><span class="p">,</span>
    <span class="na">fb</span><span class="p">:</span> <span class="mi">8545</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// process.env.&lt;key&gt; to set webhook for adapter</span>
<span class="kd">var</span> <span class="nx">adapterWebhookKey</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">telegram</span><span class="p">:</span> <span class="s1">'TELEGRAM_WEBHOOK'</span><span class="p">,</span>
  <span class="na">fb</span><span class="p">:</span> <span class="s1">'FB_WEBHOOK_BASE'</span>
<span class="p">}</span>
</code></pre>

<p>If the webhook environment key is not specified, then ngrok will assign it a random emphemeral web url. This is especially useful if you wish to specify a Heroku url, or a custom ngrok url. </p>

<blockquote>
<p>For example, since Facebook takes 10 minutes to update a webhook, we wish to use a persistent webhook url. We leave Telegram to a random url generated by ngrok.</p>
</blockquote>
<pre class="highlight shell"><code><span class="c"># bin/.keys-aiva</span>
<span class="nv">FB_WEBHOOK</span><span class="o">=</span>https://aivabot.ngrok.com
<span class="c"># TELEGRAM_WEBHOOK is not net</span>

<span class="c"># ... AIVA is run, Telegram is given a random url</span>
<span class="c"># stdout log</span>
<span class="o">[</span>Wed Jun 01 2016 12:02:33 GMT+0000 <span class="o">(</span>UTC<span class="o">)]</span> INFO telegram webhook url:  https://ddba2b46.ngrok.io at PORT: 8443
<span class="o">[</span>Wed Jun 01 2016 12:02:33 GMT+0000 <span class="o">(</span>UTC<span class="o">)]</span> INFO Deploy bot: AIVAthebot with adapter: telegram
<span class="o">[</span>Wed Jun 01 2016 12:02:33 GMT+0000 <span class="o">(</span>UTC<span class="o">)]</span> INFO fb webhook url:  https://aivadev.ngrok.io at PORT: 8545
<span class="o">[</span>Wed Jun 01 2016 12:02:33 GMT+0000 <span class="o">(</span>UTC<span class="o">)]</span> INFO Deploy bot: aivadev with adapter: fb
</code></pre>

<aside class="notice">
If you use a custom ngrok domain, be sure to <a href="https://ngrok.com/docs#authtoken" target="_blank">install your authtoken before hand</a>. A ngrok custom url cannot be used twice.
</aside>

<aside class="notice">
Remember to use HTTPS urls.
</aside>

<h2 id="neo4j">Neo4j</h2>

<p>If it&rsquo;s your first installation of <code class="prettyprint">Neo4j</code>, the <code class="prettyprint">bin/install</code> script will reset the default <code class="prettyprint">username:pswd</code> from <code class="prettyprint">neo4j:neo4j</code> to <code class="prettyprint">neo4j:0000</code>, as required for direct usage. This is also consistent with the default <code class="prettyprint">NEO4J_AUTH</code> in <code class="prettyprint">.env</code>. If you wish to reset to your own password, use below:</p>
<pre class="highlight shell"><code>neo4j start
<span class="c"># change your password</span>
<span class="c"># note the default username:pswd is neo4j:0000</span>
curl -X POST -d <span class="s2">"password=YOUR_NEW_PASSWORD"</span> -u neo4j:&lt;OLD_PSWD&gt; http://localhost:7474/user/neo4j/password
</code></pre>

<p>Access the Neo4j browser GUI at <a href="http://localhost:7474"><code class="prettyprint">http://localhost:7474</code></a> (production) or <a href="http://localhost:7476"><code class="prettyprint">http://localhost:7476</code></a> (development)</p>

<h2 id="ssh-browser-forwarding">SSH Browser-forwarding</h2>

<p>If you&rsquo;re hosting Neo4j on a remote machine and want to access its browser GUI on your local machine, connect to it via </p>
<pre class="highlight shell"><code>ssh -L 8080:localhost:7474 &lt;remote_host&gt;
</code></pre>

<p>Then you can go to <code class="prettyprint">http://localhost:8080/</code> on your local browser.</p>

          <h1 id="roadmap-amp-changelog"><a name="changelog"></a>Roadmap &amp; Changelog</h1>

<p><a href="https://github.com/kengz/aiva/blob/master/docs/CHANGELOG.md" target="_blank"><code>See the Roadmap and Changelog on Github.</code></a></p>

<p>The current phase focuses on <strong>system</strong> design. The next phases will deal with more integrated NLP, usage of the graph brain, and built in functions of a virtual assistant.</p>

          <h1 id="contributing"><a name="contributing"></a>Contributing</h1>

<p>We&rsquo;d love for you to contribute and make AIVA even better for all developers. We&rsquo;re mainly interested in something generic and foundational, e.g. adding client for a new language, improving the NLP, adding a useful generic module, adding more adapters like Skype or Twilio.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
